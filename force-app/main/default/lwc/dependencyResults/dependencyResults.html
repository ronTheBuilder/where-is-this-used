<template>
    <!-- Current lookup indicator -->
    <div class="slds-box slds-box_x-small slds-theme_info slds-m-bottom_medium">
        <span class="slds-text-body_small">
            Showing results for <strong>{componentName}</strong>
            <span class="slds-badge slds-badge_lightest slds-m-left_xx-small">{metadataType}</span>
        </span>
    </div>

    <!-- Warning if limit reached -->
    <template if:true={limitReached}>
        <div class="slds-notify slds-notify_alert slds-alert_warning slds-m-bottom_medium" role="alert">
            <span class="slds-assistive-text">warning</span>
            <h2>{warningMessage}</h2>
        </div>
    </template>

    <!-- Results header -->
    <div class="slds-grid slds-grid_align-spread slds-m-bottom_small">
        <h2 class="slds-text-heading_small">
            <strong>{totalCount}</strong> references found
            <span class="slds-text-body_small slds-text-color_weak slds-m-left_xx-small">across {groupCount} metadata types</span>
        </h2>
    </div>

    <!-- Filter badges -->
    <div class="slds-m-bottom_medium">
        <template for:each={filterBadges} for:item="badge">
            <lightning-badge
                key={badge.value}
                label={badge.label}
                data-value={badge.value}
                onclick={handleFilterClick}
                class={badge.isActive ? 'slds-m-right_xx-small slds-badge_inverse' : 'slds-m-right_xx-small'}>
            </lightning-badge>
        </template>
    </div>

    <!-- Accordion results -->
    <template for:each={filteredGroups} for:item="group">
        <div key={group.componentType} class="slds-card slds-m-bottom_x-small">
            <!-- Group header -->
            <div class="slds-grid slds-grid_vertical-align-center slds-p-around_small slds-border_bottom"
                 data-type={group.componentType}
                 onclick={handleToggleGroup}
                 style="cursor: pointer;">
                <lightning-icon
                    icon-name={group.iconName}
                    size="small"
                    class="slds-m-right_small">
                </lightning-icon>
                <span class="slds-text-title_caps slds-grow">{group.componentType}</span>
                <lightning-badge label={group.count}></lightning-badge>
                <lightning-icon
                    icon-name={group.isExpanded ? 'utility:chevrondown' : 'utility:chevronright'}
                    size="x-small"
                    class="slds-m-left_small">
                </lightning-icon>
            </div>

            <!-- Group records -->
            <template if:true={group.isExpanded}>
                <template for:each={group.records} for:item="record">
                    <div key={record.key} class="slds-grid slds-grid_vertical-align-center slds-p-horizontal_medium slds-p-vertical_x-small slds-border_bottom">
                        <span class="slds-grow slds-truncate slds-text-link">
                            {record.metadataComponentName}
                        </span>
                        <template if:true={record.metadataComponentNamespace}>
                            <span class="slds-badge slds-badge_lightest slds-m-right_small">{record.metadataComponentNamespace}</span>
                        </template>
                        <template if:true={record.hasBadge}>
                            <lightning-badge label={record.badgeLabel} class="slds-m-right_small"></lightning-badge>
                        </template>
                        <template if:true={record.hasSetupUrl}>
                            <lightning-button-icon
                                icon-name="utility:new_window"
                                alternative-text="Open in Setup"
                                data-url={record.setupUrl}
                                onclick={handleOpenSetup}
                                size="small">
                            </lightning-button-icon>
                        </template>
                    </div>
                </template>
            </template>
        </div>
    </template>
</template>
